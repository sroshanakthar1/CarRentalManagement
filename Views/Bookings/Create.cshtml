@model CarRentalManagement.Models.Booking

@{
    ViewData["Title"] = "Book Car";
}

<h2>Book Car</h2>

@if (Model.Car != null)
{
    <!-- Car Card -->
    <div class="card shadow mb-4" style="max-width: 500px; margin:auto;">
        <div class="card-body text-center">
            <img src="@Model.Car.ImageUrl"
                 alt="@Model.Car.CarName"
                 style="width:250px; height:150px; object-fit:cover; border-radius:8px; margin-bottom:15px;"
                 onerror="this.src='/images/car/default.png'" />
            <h5 class="card-title">@Model.Car.CarName (@Model.Car.CarModel)</h5>
            <p>Transmission:  @Model.Car.Transmission</p>
            <p>Fuel: @Model.Car.FuelType</p>
            <p>Seats: @Model.Car.SeatingCapacity</p>
            <p class="fw-bold text-warning">Price/Day:@Model.Car.PricePerDay.ToString("C")</p>
        </div>
    </div>
}

<form asp-action="Create" method="post">
    <input type="hidden" asp-for="CarID" />

    <div class="mb-3">
        <label asp-for="PickupDate" class="form-label"></label>
        <input asp-for="PickupDate" type="date" class="form-control" />
        <span asp-validation-for="PickupDate" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="ReturnDate" class="form-label"></label>
        <input asp-for="ReturnDate" type="date" class="form-control" />
        <span asp-validation-for="ReturnDate" class="text-danger"></span>
    </div>

    <button type="submit" class="btn btn-success">PA</button>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        const pricePerDay = @Model.Car.PricePerDay;

        function calculateTotal() {
            const pickup = new Date(document.getElementById("PickupDate").value);
            const ret = new Date(document.getElementById("ReturnDate").value);

            if (!isNaN(pickup) && !isNaN(ret) && ret > pickup) {
                const days = (ret - pickup) / (1000 * 3600 * 24); // ms → days
                const total = days * pricePerDay;
                document.getElementById("TotalCost").value = total.toFixed(2);
            } else {
                document.getElementById("TotalCost").value = "";
            }
        }

        document.getElementById("PickupDate").addEventListener("change", calculateTotal);
        document.getElementById("ReturnDate").addEventListener("change", calculateTotal);
    </script>
}